<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Day Trading Stock Picker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { RefreshCw, TrendingUp, Clock, AlertCircle, DollarSign, Globe } = lucide;

        function DayTradingPicker() {
          const [currentTime, setCurrentTime] = useState(new Date());
          const [stocks, setStocks] = useState([]);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [marketStatuses, setMarketStatuses] = useState({
            us: { isOpen: false, message: '' },
            london: { isOpen: false, message: '' },
            tokyo: { isOpen: false, message: '' }
          });

          useEffect(() => {
            const timer = setInterval(() => {
              setCurrentTime(new Date());
            }, 1000);
            
            checkAllMarketStatuses();
            return () => clearInterval(timer);
          }, []);

          const checkAllMarketStatuses = () => {
            const now = new Date();
            
            // US Market
            const etTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            const usDay = etTime.getDay();
            const usHours = etTime.getHours();
            const usMinutes = etTime.getMinutes();
            const usCurrentMinutes = usHours * 60 + usMinutes;
            const usMarketOpen = 9 * 60 + 30;
            const usMarketClose = 16 * 60;
            const usIsWeekday = usDay >= 1 && usDay <= 5;
            const usIsDuringMarketHours = usCurrentMinutes >= usMarketOpen && usCurrentMinutes < usMarketClose;
            const usIsOpen = usIsWeekday && usIsDuringMarketHours;
            
            let usMessage = '';
            if (!usIsWeekday) {
              usMessage = 'Closed (Weekend)';
            } else if (usCurrentMinutes < usMarketOpen) {
              usMessage = 'Opens 9:30 AM ET';
            } else if (usCurrentMinutes >= usMarketClose) {
              usMessage = 'Closed 4:00 PM ET';
            } else {
              usMessage = 'OPEN';
            }
            
            // London Market
            const londonTime = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/London' }));
            const londonDay = londonTime.getDay();
            const londonHours = londonTime.getHours();
            const londonMinutes = londonTime.getMinutes();
            const londonCurrentMinutes = londonHours * 60 + londonMinutes;
            const londonMarketOpen = 8 * 60;
            const londonMarketClose = 16 * 60 + 30;
            const londonIsWeekday = londonDay >= 1 && londonDay <= 5;
            const londonIsDuringMarketHours = londonCurrentMinutes >= londonMarketOpen && londonCurrentMinutes < londonMarketClose;
            const londonIsOpen = londonIsWeekday && londonIsDuringMarketHours;
            
            let londonMessage = '';
            if (!londonIsWeekday) {
              londonMessage = 'Closed (Weekend)';
            } else if (londonCurrentMinutes < londonMarketOpen) {
              londonMessage = 'Opens 8:00 AM GMT';
            } else if (londonCurrentMinutes >= londonMarketClose) {
              londonMessage = 'Closed 4:30 PM GMT';
            } else {
              londonMessage = 'OPEN';
            }
            
            // Tokyo Market
            const tokyoTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tokyo' }));
            const tokyoDay = tokyoTime.getDay();
            const tokyoHours = tokyoTime.getHours();
            const tokyoMinutes = tokyoTime.getMinutes();
            const tokyoCurrentMinutes = tokyoHours * 60 + tokyoMinutes;
            const tokyoMorningOpen = 9 * 60;
            const tokyoLunchStart = 11 * 60 + 30;
            const tokyoLunchEnd = 12 * 60 + 30;
            const tokyoMarketClose = 15 * 60;
            const tokyoIsWeekday = tokyoDay >= 1 && tokyoDay <= 5;
            const tokyoIsOpen = tokyoIsWeekday && 
              ((tokyoCurrentMinutes >= tokyoMorningOpen && tokyoCurrentMinutes < tokyoLunchStart) ||
               (tokyoCurrentMinutes >= tokyoLunchEnd && tokyoCurrentMinutes < tokyoMarketClose));
            
            let tokyoMessage = '';
            if (!tokyoIsWeekday) {
              tokyoMessage = 'Closed (Weekend)';
            } else if (tokyoCurrentMinutes < tokyoMorningOpen) {
              tokyoMessage = 'Opens 9:00 AM JST';
            } else if (tokyoCurrentMinutes >= tokyoLunchStart && tokyoCurrentMinutes < tokyoLunchEnd) {
              tokyoMessage = 'Lunch Break';
            } else if (tokyoCurrentMinutes >= tokyoMarketClose) {
              tokyoMessage = 'Closed 3:00 PM JST';
            } else {
              tokyoMessage = 'OPEN';
            }
            
            setMarketStatuses({
              us: { isOpen: usIsOpen, message: usMessage },
              london: { isOpen: londonIsOpen, message: londonMessage },
              tokyo: { isOpen: tokyoIsOpen, message: tokyoMessage }
            });
          };

          const fetchStockPicks = async () => {
            setLoading(true);
            setError(null);
            
            const openMarkets = [];
            if (marketStatuses.us.isOpen) openMarkets.push('US (NYSE/NASDAQ)');
            if (marketStatuses.london.isOpen) openMarkets.push('London (LSE)');
            if (marketStatuses.tokyo.isOpen) openMarkets.push('Tokyo (TSE)');
            
            if (openMarkets.length === 0) {
              setError('No markets are currently open. Please try again during trading hours.');
              setLoading(false);
              return;
            }
            
            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 4000,
                  tools: [{
                    type: "web_search_20250305",
                    name: "web_search"
                  }],
                  messages: [{
                    role: "user",
                    content: `You are a global day trading stock analyst. Search and analyze current stock recommendations from these sources for TODAY (${currentTime.toDateString()}):

SOURCES TO SEARCH:
1. finviz.com - US top gainers and active stocks
2. tradingview.com - trending ideas globally
3. thetraderisk.com - day trading picks
4. stocktwits.com - trending US stocks
5. spiking.com - real-time picks
6. fool.co.uk - UK Motley Fool recommendations
7. uk.finance.yahoo.com - UK/European stocks
8. marketwatch.com - global market movers
9. investing.com - international stocks and analysis

CURRENTLY OPEN MARKETS: ${openMarkets.join(', ')}

CRITICAL: Only include stocks from the currently OPEN markets listed above. 
- If US market is open: Include US stocks (ticker symbols like AAPL, TSLA)
- If London market is open: Include UK stocks (ticker symbols like LLOY.L, BP.L with .L suffix)
- If Tokyo market is open: Include Japanese stocks (ticker symbols like 7203.T, 6758.T with .T suffix)

Find stocks that multiple sources recommend as good day trading opportunities TODAY from ONLY the open markets.

Return ONLY a JSON array of exactly 5 stocks, no preamble or markdown. Format:
[
  {
    "symbol": "TICKER",
    "name": "Company Name",
    "price": "current price with currency",
    "change": "+X.XX%",
    "volume": "volume info",
    "market": "US/London/Tokyo",
    "reason": "Brief reason why this is a good day trade (mention which sources recommend it)",
    "sources": ["source1", "source2"]
  }
]

Be specific about current prices and changes. Only include stocks from currently open markets.`
                  }]
                })
              });

              const data = await response.json();
              
              let fullResponse = '';
              if (data.content) {
                for (const item of data.content) {
                  if (item.type === 'text') {
                    fullResponse += item.text;
                  }
                }
              }
              
              const jsonMatch = fullResponse.match(/\[[\s\S]*\]/);
              if (jsonMatch) {
                const stockData = JSON.parse(jsonMatch[0]);
                setStocks(stockData);
              } else {
                throw new Error('Could not parse stock data from response');
              }
              
            } catch (err) {
              console.error('Error fetching stocks:', err);
              setError('Failed to fetch stock recommendations. Please try again.');
            } finally {
              setLoading(false);
            }
          };

          useEffect(() => {
            checkAllMarketStatuses();
            const statusInterval = setInterval(checkAllMarketStatuses, 60000);
            return () => clearInterval(statusInterval);
          }, []);

          const getMarketColor = (isOpen) => {
            return isOpen 
              ? 'bg-emerald-900/30 text-emerald-400 border-emerald-700' 
              : 'bg-slate-800/50 text-slate-400 border-slate-700';
          };

          const getMarketBadgeColor = (market) => {
            switch(market) {
              case 'US': return 'bg-blue-900/30 text-blue-300 border-blue-700';
              case 'London': return 'bg-purple-900/30 text-purple-300 border-purple-700';
              case 'Tokyo': return 'bg-red-900/30 text-red-300 border-red-700';
              default: return 'bg-slate-900/30 text-slate-300 border-slate-700';
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-6">
              <div className="max-w-7xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 via-purple-400 to-emerald-400 bg-clip-text text-transparent">
                    Global Day Trading Stock Picker
                  </h1>
                  <div className="flex items-center justify-center gap-4 text-lg mb-4 flex-wrap">
                    <div className="flex items-center gap-2 bg-slate-800/50 px-4 py-2 rounded-lg backdrop-blur">
                      <Clock className="w-5 h-5 text-blue-400" />
                      <span className="font-mono">{currentTime.toLocaleString()}</span>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
                    {Object.entries(marketStatuses).map(([key, status]) => {
                      const marketNames = { us: 'US Markets', london: 'London (LSE)', tokyo: 'Tokyo (TSE)' };
                      return (
                        <div key={key} className={`flex flex-col items-center gap-2 px-4 py-3 rounded-lg backdrop-blur border ${getMarketColor(status.isOpen)}`}>
                          <div className="flex items-center gap-2">
                            <Globe className="w-4 h-4" />
                            <span className="font-bold">{marketNames[key]}</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className={`w-2 h-2 rounded-full ${status.isOpen ? 'bg-emerald-400 animate-pulse' : 'bg-slate-500'}`} />
                            <span className="text-sm">{status.message}</span>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                <div className="text-center mb-8">
                  <button
                    onClick={fetchStockPicks}
                    disabled={loading}
                    className="bg-gradient-to-r from-blue-600 via-purple-600 to-emerald-600 hover:from-blue-700 hover:via-purple-700 hover:to-emerald-700 disabled:from-slate-600 disabled:to-slate-700 text-white font-bold py-4 px-8 rounded-xl transition-all duration-200 transform hover:scale-105 disabled:scale-100 disabled:cursor-not-allowed shadow-lg flex items-center gap-3 mx-auto"
                  >
                    <RefreshCw className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} />
                    {loading ? 'Analyzing Global Markets...' : 'Get Top 5 Picks'}
                  </button>
                </div>

                {error && (
                  <div className="bg-red-900/20 border border-red-500 rounded-lg p-4 mb-6 flex items-center gap-3">
                    <AlertCircle className="w-5 h-5 text-red-400" />
                    <span className="text-red-300">{error}</span>
                  </div>
                )}

                {stocks.length > 0 && (
                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold text-center mb-6 flex items-center justify-center gap-2">
                      <TrendingUp className="w-6 h-6 text-emerald-400" />
                      Top 5 Global Day Trading Picks
                    </h2>
                    
                    {stocks.map((stock, index) => (
                      <div
                        key={index}
                        className="bg-slate-800/50 backdrop-blur border border-slate-700 rounded-xl p-6 hover:border-purple-500 transition-all duration-200 transform hover:scale-[1.02]"
                      >
                        <div className="flex items-start justify-between mb-4 flex-wrap gap-4">
                          <div className="flex items-center gap-4">
                            <div className="bg-gradient-to-br from-blue-600 via-purple-600 to-emerald-600 text-white w-12 h-12 rounded-lg flex items-center justify-center font-bold text-xl flex-shrink-0">
                              {index + 1}
                            </div>
                            <div>
                              <div className="flex items-center gap-2 flex-wrap">
                                <h3 className="text-2xl font-bold text-blue-400">{stock.symbol}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${getMarketBadgeColor(stock.market)}`}>
                                  {stock.market}
                                </span>
                              </div>
                              <p className="text-slate-400">{stock.name}</p>
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="flex items-center gap-2 text-2xl font-bold text-white">
                              <DollarSign className="w-6 h-6" />
                              {stock.price}
                            </div>
                            <div className={`text-lg font-semibold ${stock.change.startsWith('+') ? 'text-emerald-400' : 'text-red-400'}`}>
                              {stock.change}
                            </div>
                          </div>
                        </div>
                        
                        <div className="space-y-3">
                          <div className="flex items-center gap-2 text-slate-300">
                            <span className="font-semibold text-slate-400">Volume:</span>
                            <span>{stock.volume}</span>
                          </div>
                          
                          <div className="bg-slate-900/50 rounded-lg p-4">
                            <p className="text-slate-300 leading-relaxed">{stock.reason}</p>
                          </div>
                          
                          <div className="flex flex-wrap gap-2">
                            {stock.sources.map((source, idx) => (
                              <span
                                key={idx}
                                className="bg-blue-900/30 text-blue-300 px-3 py-1 rounded-full text-sm border border-blue-700"
                              >
                                {source}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>
                    ))}
                    
                    <div className="bg-amber-900/20 border border-amber-600 rounded-lg p-4 mt-6">
                      <div className="flex items-start gap-3">
                        <AlertCircle className="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5" />
                        <div className="text-sm text-amber-200">
                          <strong className="block mb-1">Disclaimer:</strong>
                          This information is for educational purposes only and does not constitute financial advice. 
                          Day trading carries significant risk. Always conduct your own research and consider consulting 
                          with a financial advisor before making trading decisions. Currency conversions and international 
                          trading may incur additional fees and risks.
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {!loading && stocks.length === 0 && !error && (
                  <div className="text-center text-slate-400 py-12">
                    <Globe className="w-16 h-16 mx-auto mb-4 opacity-50" />
                    <p className="text-xl mb-2">Click the button above to get today's top 5 global day trading picks</p>
                    <p className="text-sm">Analyzes stocks from open markets only</p>
                    <div className="mt-4 text-xs text-slate-500 max-w-2xl mx-auto">
                      <p className="mb-2">Sources: Finviz, TradingView, TheTradeRisk, StockTwits, Spiking,</p>
                      <p>Motley Fool UK, Yahoo Finance UK, MarketWatch, Investing.com</p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DayTradingPicker />);
    </script>
</body>
</html>
